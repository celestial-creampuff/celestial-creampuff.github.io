---
title: "[AWS] VPC 구축"
date: 2023-07-01 00:00:00 -0400
categories: AWS VPC
tags:
    - AWS
    - VPC
toc: true
toc_sticky: true
---

## 학습목표

이번 Hands-on을 통한 목표는 아래와 같습니다!

1. AWS 콘솔에서 기본적인 사용법과 UI를 익힙니다.
2. 기본 VPC가 아닌, 사용자가 직접 VPC를 만드는 방법을 알아갑니다.
3. 완전한 VPC를 구축함으로써,VPC의 구성 요소를 파악합니다.

## 1. VPC구성하기

### 1-1. Amazon VPC란?
**AWS VPC(Virtual Private Cloud)**란 논리적으로 격리된 가상 네트워크를 뜻합니다. 즉 눈에 보이지 않는 데이터 센터에 비유할 수 있으며, VPC를 만들어서 사용자가 정의한 가상 네트워크에서 AWS 리소스를 구축할 수 있습니다.

VPC를 구축함으로써, 우리는 아래와 같은 장점들을 얻을 수 있습니다.

- 인터넷 연결을 보호하며, 허가되지 않은 트래픽을 차단하고 가상 네트워크 내부 인스턴스 액세스를 제어해서 보안적인 면을 얻을 수 있어요.
- 또한 자체 IP 주소 범위를 선택하고, 서브넷과 라우팅 테이블을 구성하여 사용자가 직접 지정할 수 있습니다!

이제 한 번 VPC를 생성해보겠습니다.

### 1-2. VPC 생성

1. 먼저 콘솔에서 로그인을 합니다! 그리고 상단 돋보기 버튼을 누르고 'vpc'를 입력하면 VPC 리소스가 보일텐데 그걸 클릭해주세요.
![VPC 콘솔 접속](/assets/2023-06-30-vpc/2023-06-28-13-49-02.png)
    
2. 상단에 VPC 생성 버튼을 클릭합니다.
![VPC 생성](/assets/2023-06-30-vpc/2023-06-28-13-49-17.png)
    
3. 생성할 리소스는 'VPC만'을 클릭하고 이름을 입력합니다! 그리고 IP CIDR 대역은 아래와 같이 생성해줬습니다.
마지막으로 VPC 생성을 클릭합니다!
![VPC 구성 편집](/assets/2023-06-30-vpc/2023-06-28-13-49-44.png)
    
4. 아래 사진처럼 우리는 VPC가 만들어진 것을 볼 수 있어요.
하지만 지금 만든 VPC는 논리적으로 공간만 격리되게 만들었지만, 제 기능은 할 수 없다고 보면 됩니다!
우선 DNS 호스트 이름과 네트워크 주소 사용 지표를 활성화하기 위해 우측 상단 작업에서 VPC 설정 편집에 들어갑니다.
![DNS 호스트 이름 및 네트워크 주소 사용 지표 활성](/assets/2023-06-30-vpc/2023-06-28-13-50-19.png)
    
5. DNS 설정에서는 DNS 호스트 이름 활성화를 체크해주고, 네트워크 주소 사용 지표 설정에서는 네트워크 주소 사용 지표 활성화를 체크해주세요.
![DNS 호스트 이름 및 네트워크 주소 사용 지표 활성2](/assets/2023-06-30-vpc/2023-06-28-13-50-34.png)

6. 그러면 이렇게 저희가 수정한 VPC를 볼 수 있습니다.
![VPC 구성 완료](/assets/2023-06-30-vpc/2023-06-28-13-51-42.png)

바로 다음으로 서브넷을 생성하는 단계로 넘어가보겠습니다!

## 3. 서브넷에 대해

### 3-1. 서브넷이란?
**서브넷(Subnet)**이란 VPC의 IP 주소 범위를 뜻합니다. 각 서브넷은 단일 가용 영역 내에서만 존재해야 하며, 여러 영역으로 확장할 수 없어요.
서브넷을 통해 저희는 별도의 가용 영역에서 AWS 리소스를 시작할 수 있고, 애플리케이션을 격리시켜 보호할 수 있습니다!

### 3-2. 서브넷의 특징
AWS에서 서브넷은 주로 4가지 특징을 가진 서브넷이 있습니다. 이 4가지 특징은 AWS에서 정해준 것이 아니며, 사용자가 어떠한 네트워크를 구축할 지에 대해 생각하고 직접 커스터마이징을 하면 돼요!

- 퍼블릭 서브넷:

서브넷에 인터넷 게이트웨이로 직접 연결이 되는 경로입니다. 퍼블릭 서브넷에 배치된 AWS리소스는 퍼블릭 인터넷에 바로 액세스가 가능해요.

- 프라이빗 서브넷:

인터넷 게이트웨이로 직접 연결된 경로가 없는 서브넷을 말하며, 프라이빗 서브넷에 있는 리소스는 NAT Gateway를 통해야만 퍼블릭 인터넷에 접근이 가능합니다!
그래서 프라이빗 서브넷에 배치된 리소스는 기본적으로 퍼블릭 인터넷에 접근할 수 없으며, 접근하고 싶다면 NAT Gateway를 연결해야 합니다.

- VPN 전용 서브넷:

서브넷에 가상 프라이빗 게이트웨이를 통해 Site-to-Site VPN 연결을 통해 연결되는 경로이며, 인터넷 게이트웨이와 직접적으로나 간접적으로 연결된 경로는 없습니다.

- 격리된 서브넷:

서브넷에 VPC 외부 대상에 대한 경로가 없으면 격리된 서브넷의 리소스는 동일한 VPC의 다른 리소스와만 서로 액세스가 가능합니다.

이렇게 서브넷을 이야기 해봤습니다!
주로 AWS를 사용한다면 퍼블릭 서브넷과 프라이빗 서브넷에 대해서는 이해를 하고 있어야 하며 리소스를 어떻게 배치해야 할 것인지 생각을 하고, 만약 보안을 중요하게 생각한다면 프라이빗 서브넷에 AWS 리소스를 배치하여 보호하는 것이 좋습니다!
만약 프라이빗 서브넷에 접근하고 싶다면 퍼블릭 서브넷에 Bastion Host 또는 NAT Gateway를 구성하여 EC2 인스턴스에 대해 인터넷 액세스를 하는 것이 좋아요.

### 3-3. 서브넷 구성하기
지금부턴 서브넷을 만드는 과정을 보여드리겠습니다!<br><br>
총 8개의 Subnet을 생성하려고 해요. Public Subnet 2개, Web Subnet 2개, Was Subnet 2개, DB 서브넷 2개씩 만들겁니다.<br>

각각의 IP 대역은 아래를 참고해주세요!<br>
그리고 새 서브넷 추가를 눌러서 계속 서브넷을 늘릴 수 있습니다. 그리고 다 만드셨다면 하단에 서브넷 생성을 클릭하면 됩니다!<br>
![서브넷 만들기 1](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.30.38.png)

![서브넷 만들기 2](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.30.47.png)

![서브넷 만들기 3](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.31.35.png)

![서브넷 만들기 4](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.32.09.png)

![서브넷 만들기 5](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.35.49.png)

![서브넷 만들기 6](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.35.54.png)

![서브넷 만들기 7](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.35.58.png)

![서브넷 만들기 8](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.36.02.png)

![서브넷 만들기 9](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.36.07.png)

![서브넷 만들기 10](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.36.18.png)
<br><br>
다 생성하셨으면 아래와 같이 만들어진 서브넷 목록을 확인하실 수 있습니다!
![서브넷 만들기 10](/assets/2023-08-19_Subnet/스크린샷%202023-08-19%20오전%2010.36.43.png)


## 4. 인터넷 게이트웨이 구축 및 연결

### 4-1. 인터넷 게이트웨이란?
**인터넷 게이트웨이(IGW, Internet Gateway)**란
인터넷 게이트웨이는 VPC 구성 요소 중 하나이며, VPC에 있는 AWS 리소스와 인터넷 간에 통신을 할 수 있게 해주는 **관문**이라고 보면 됩니다.
인터넷 게이트웨이가 없으면 기본적으로 외부 인터넷과 AWS의 리소스들은 통신을 할 수 없어요. 만약 VPN 또는 SSM을 사용하지 않고 외부 인터넷과 통신을 하게 하고 싶다면 인터넷 게이트웨이를 거쳐야만 서로의 트래픽이 오고 갈 수 있습니다!

### 4-2. 인터넷 게이트웨이 만들기
![인터넷 게이트웨이 생성 1](/assets/2023-08-19-IGW/스크린샷%202023-08-19%20오전%2010.36.58.png)

![인터넷 게이트웨이 생성 2](/assets/2023-08-19-IGW/스크린샷%202023-08-19%20오전%2010.37.15.png)

![인터넷 게이트웨이 생성 3](/assets/2023-08-19-IGW/스크린샷%202023-08-19%20오전%2010.37.26.png)

![인터넷 게이트웨이 생성 4](/assets/2023-08-19-IGW/스크린샷%202023-08-19%20오전%2010.37.32.png)

![인터넷 게이트웨이 생성 5](/assets/2023-08-19-IGW/스크린샷%202023-08-19%20오전%2010.37.42.png)


## 5. 라우팅 테이블(RTB, Routing Table)

## 5-1. 라우팅 테이블에 대해서
**라우팅 테이블(Routing Table, RTB)**란, 서브넷 또는 게이트웨이의 네트워크 트래픽이 전송되는 위치를 결정하는 규칙 세트의 집합입니다. 즉 네트워크 트래픽이 **이정표**를 보고 도착지점에 간다고 이해하면 쉬울거예요!
AWS에서 이런 라우팅 테이블을 통해 저희는 서브넷에 대한 라우팅을 제어할 수 있으며, 서브넷을 특정 라우팅 테이블과 명시적으로 연결할 수 있습니다.


## 5-2. 라우팅 테이블 구성 및 서브넷 연결 구성하기


## 참고 및 출처

[서브넷](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/configure-subnets.html)

[라우팅테이블](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/VPC_Route_Tables.html)